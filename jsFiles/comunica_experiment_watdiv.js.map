{"version":3,"file":"comunica_experiment_watdiv.js","sourceRoot":"","sources":["../comunica_experiment_watdiv.ts"],"names":[],"mappings":"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","sourcesContent":["import {MCTSJoinInformation, runningMoments, aggregateValues} from '@comunica/model-trainer';\nimport * as fs from 'fs'\nimport * as path from 'node:path'\n\nclass trainComunicaModel{\n    public engine: any;\n    public queries: string[];\n    public queriesEasy: string[];\n    public queriesMedium: string[];\n    public queriesHard: string[];\n    public loadedQueries: Promise<boolean>;\n    public modelTrainer;\n    public masterTree: any;\n    public runningMoments: runningMoments;\n\n    public constructor(){\n        const QueryEngine = require('@comunica/query-sparql-file').QueryEngineFactory;\n        this.modelTrainer = require('@comunica/model-trainer');\n        this.runningMoments = {indexes: [0,7], runningStats: new Map<number, aggregateValues>()};\n        for (const index of this.runningMoments.indexes){\n            const startPoint: aggregateValues = {N: 0, mean: 0, std: 1, M2: 1}\n            this.runningMoments.runningStats.set(index, startPoint);\n        }\n\n        this.masterTree = new this.modelTrainer.MCTSMasterTree(this.runningMoments);        \n        this.engine = new QueryEngine().create({\n            configPath: __dirname+\"/config-file.json\", // Relative or absolute path \n        });\n        this.queries = [];\n        this.queriesEasy=[];\n        this.queriesMedium=[];\n        this.queriesHard=[];\n    }\n\n    public async executeQuery(query: string, sources:string[], planHolder: Map<string, number>, validation: boolean){\n        this.engine = await this.engine;\n        const bindingsStream = await this.engine.queryBindings(query, {sources: sources, masterTree: this.masterTree, planHolder: planHolder, validation: validation});\n        return bindingsStream\n    }\n\n    public async explainQuery(query:string, sources:string[]){\n        const results = await this.engine.explain(query, {sources: sources, masterTree: this.masterTree});\n        return results\n\n    }\n\n    public async trainModel(masterMap: Map<string, MCTSJoinInformation>, numEntries: number): Promise<number>{\n        // this.engine.getModelHolder().getModel().layersValue[0][0].mWeights.print() \n        this.engine = await this.engine;\n        const episodeLoss = this.engine.trainModel(masterMap, numEntries);\n        // this.engine.getModelHolder().getModel().denseLayerValue.getWeights()[0].print();\n        return episodeLoss\n    }\n\n\n    public async loadWatDivQueriesStrength(queryDir: string, difficulty: \"easy\"|\"medium\"|\"hard\"){\n        const loadingComplete = new Promise<boolean> (async (resolve, reject) => {\n            try {\n                // Get the files as an array\n                const files = await fs.promises.readdir( queryDir );\n                for( const file of files ) {\n                    // Get the full paths\n                    const filePath = path.join( queryDir, file );    \n                    const data = fs.readFileSync(filePath,'utf8');\n                    if (difficulty=='easy'){\n                        this.queriesEasy.push(data);\n                    }\n                    if (difficulty=='medium'){\n                        this.queriesMedium.push(data);\n                    }\n                    if(difficulty=='hard'){\n                        this.queriesHard.push(data);\n                    }\n                }\n                resolve(true); \n            }\n            catch( e ) {\n                console.error( \"Something went wrong.\", e );\n                reject();\n            }\n        });\n        return loadingComplete;\n    }\n    public async loadWatDivQueries(queryDir: string){\n        const loadingComplete = new Promise<boolean> (async (resolve, reject) => {\n            try {\n                await this.loadWatDivQueriesStrength(queryDir+'/easy', 'easy');\n                await this.loadWatDivQueriesStrength(queryDir+'/medium', 'medium');\n                await this.loadWatDivQueriesStrength(queryDir+'/hard', 'hard');\n                resolve(true); \n            }\n            catch( e ) {\n                console.error( \"Something went wrong.\", e );\n                reject();\n            }\n        });\n        return loadingComplete;\n    }\n\n    public resetMasterTree(){\n        this.masterTree = new this.modelTrainer.MCTSMasterTree(this.runningMoments);\n    }\n\n    public async awaitEngine(){\n        this.engine = await this.engine\n    }\n\n}\nconst nResults = [\n    0, 0,  0,  0, 4374, 4374,  0, 0,  1,\n    0, 0,  0,  0,    0,   33, 33, 3,  3,\n    1, 1, 60, 34,    0,    0,  2, 1, 13,\n    0, 0,  2,  0,    0,    0,  0, 0,  0,\n    0, 0,  2,  1\n  ]\n\n\n\nlet trainer: trainComunicaModel = new trainComunicaModel();\n\n\n\n// Training parameters\nconst numSimulationsPerQuery: number = 10;\nconst numEpochs: number = 100;\nconst hrTime = process.hrtime();\n// Initialse moments, note that std = 1 to prevent division by 0\nconst runningMomentsY: aggregateValues = {N: 0, mean: 0, std: 1, M2: 1}\nconst loadingComplete: Promise<boolean> = trainer.loadWatDivQueries('trainingData');\n// Start train on easy, continue further\nloadingComplete.then(async result => {\n    trainModel('easy', runningMomentsY, numEpochs, numSimulationsPerQuery);\n})\n\nasync function trainModel(difficulty: \"easy\"|\"medium\"|\"hard\", momentsY: aggregateValues, nEpoch: number, nSimPerQuery: number){\n    let cleanedQueriesEasy: string[][] = trainer.queriesEasy.map(x => x.replace(/\\n/g, '').replace(/\\t/g, '').split('SELECT').slice(1));\n    let cleanedQueriesMedium: string[][] = trainer.queriesMedium.map(x => x.replace(/\\n/g, '').replace(/\\t/g, '').split('SELECT').slice(1));\n    let cleanedQueriesHard: string[][] = trainer.queriesHard.map(x => x.replace(/\\n/g, '').replace(/\\t/g, '').split('SELECT').slice(1));\n    let trainQueries: string[][] = [[]]\n    if (difficulty=='easy'){\n        trainQueries = [...cleanedQueriesEasy];\n    }\n    if (difficulty=='medium'){\n        trainQueries = [...cleanedQueriesEasy, ...cleanedQueriesMedium];\n    }\n    if(difficulty=='hard'){\n        trainQueries = [...cleanedQueriesEasy, ...cleanedQueriesMedium, ...cleanedQueriesHard];\n    }\n    const trainLoss: number[] = await trainLoop(trainQueries, momentsY, nEpoch, nSimPerQuery);\n    return trainLoss\n}\nasync function trainLoop(trainQueries: string[][], momentsY: aggregateValues, nEpoch: number, nSimPerQuery: number){\n    const lossTrain: number[] = [];\n    for (let epoch = 0; epoch<nEpoch; epoch++){\n        const lossQuery: number[] = []\n        for (let i = 0; i<trainQueries.length; i++){\n            // console.log(`cleanedQueries ${i+1}/${cleanedQueries.length}`);\n            const querySubset: string[] = [... trainQueries[i]];\n            for (let j = 0; j <querySubset.length; j++){\n                /* Execute n queries and record the results */\n                for (let n = 0; n < nSimPerQuery; n++){\n                    let startTime = process.hrtime();\n                    const mapResults = new Map()\n                    const startTimeSeconds = startTime[0] + startTime[1] / 1000000000 ;\n                    const bindingsStream = await trainer.executeQuery('SELECT' + querySubset[j], [\"output/dataset.nt\"], mapResults, false);\n                    const queryPromise = addEndListener(startTimeSeconds, mapResults, trainer.masterTree.masterMap, bindingsStream, process, momentsY);\n                    await queryPromise;\n                }\n                const numEntriesQuery: number = trainer.masterTree.getTotalEntries();\n                // Normalize the y values\n                for (const key of trainer.masterTree.masterMap.keys()){\n                    const joinToNormalize: MCTSJoinInformation = trainer.masterTree.masterMap.get(key.toString());\n                    joinToNormalize.actualExecutionTime = (joinToNormalize.actualExecutionTime! - momentsY.mean)/momentsY.std;\n                }\n\n                /* Train the model using the queries*/\n                let loss: number = await trainer.trainModel(trainer.masterTree.masterMap, numEntriesQuery);\n                trainer.resetMasterTree();\n                if (loss){\n                    lossQuery.push(loss);\n                }\n            }\n        }\n        lossTrain.push(sum(lossQuery)/lossQuery.length);\n        console.log(`Epoch ${epoch}, loss: ${lossTrain[epoch]}`);\n    }\n    return lossTrain;\n}\n\nfunction sum(arr: number[]) {\n    var result = 0, n = arr.length || 0; //may use >>> 0 to ensure length is Uint32\n    while(n--) {\n      result += +arr[n]; // unary operator to ensure ToNumber conversion\n    }\n    return result;\n}\n\nfunction addEndListener(beginTime: number, planMap: Map<string, number>, masterMap: Map<string, MCTSJoinInformation>, \n    bindingStream: any, process: any, runningMomentsY: aggregateValues): Promise<boolean>{\n    /**\n     * Function that consumes the binding stream and measures elapsed time\n     */\n    const joinPlanQuery: string = Array.from(planMap)[planMap.size-1][0];\n    let numEntriesPassed: number = 0;\n    const finishedReading: Promise<boolean> = new Promise((resolve, reject) => {\n        if (!masterMap.get(joinPlanQuery)!.actualExecutionTime || masterMap.get(joinPlanQuery)!.actualExecutionTime == 0){\n            bindingStream.on('data', (binding: any) => {\n                numEntriesPassed += 1\n                // console.log(`Entry Number:${numEntriesPassed}`)\n            });\n            \n            bindingStream.on('end', () => {\n                const end: number[] = process.hrtime();\n                const endSeconds: number = end[0] + end[1] / 1000000000;\n                const elapsed: number = endSeconds-beginTime;\n                // Update the running moments\n                updateRunningMoments(runningMomentsY, elapsed);\n                // Update the standardized execution time for each joinPlan\n                planMap.forEach((value, key) => {\n                    const joinInformationPrev = masterMap.get(key.toString())! \n                    joinInformationPrev.actualExecutionTime = elapsed;\n                    masterMap.set(key.toString(), joinInformationPrev);\n                })\n                // console.log(`Elapsed time ${elapsed}`);\n                // console.log(masterMap);\n                resolve(true);\n            })    \n    }});\n    return finishedReading;\n}\n\nfunction updateRunningMoments(toUpdateAggregate: aggregateValues, newValue: number){\n    toUpdateAggregate.N +=1;\n    const delta = newValue - toUpdateAggregate.mean; \n    toUpdateAggregate.mean += delta / toUpdateAggregate.N;\n    const newDelta = newValue - toUpdateAggregate.mean;\n    toUpdateAggregate.M2 += delta * newDelta;\n    toUpdateAggregate.std = Math.sqrt(toUpdateAggregate.M2 / toUpdateAggregate.N);\n}\n"]}